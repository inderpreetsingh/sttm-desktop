/*
  ACTION SHEET
  ------------

  A dropdown menu that sticks to the bottom of the screen on small devices, and becomes a dropdown menu on larger devices.
*/

/// @Foundation.settings
// Action Sheet
$actionsheet-background: white !default;
$actionsheet-border-color: #ccc !default;
$actionsheet-animate: transform opacity !default;
$actionsheet-animation-speed: 0.25s !default;
$actionsheet-width: 300px !default;
$actionsheet-radius: 4px !default;
$actionsheet-shadow: 0 -3px 10px rgba(black, 0.25) !default;
$actionsheet-padding: $global-padding !default;
$actionsheet-tail-size: 10px !default;

$actionsheet-popup-shadow: 0 0 10px rgba(black, 0.25) !default;

$actionsheet-link-color: #000 !default;
$actionsheet-link-background-hover: smartscale($actionsheet-background) !default;
///

/*
  Styles for the list inside an action sheet.
  Don't include this mixin if you want to build custom controls inside the sheet.
*/
@mixin action-sheet-menu(
  $padding: $actionsheet-padding,
  $color: $actionsheet-link-color,
  $border-color: $actionsheet-border-color,
  $background-hover: $actionsheet-link-background-hover
) {
  // Menu container
  ul {
    list-style-type: none;
    margin: -($padding);
    margin-top: 0;
    user-select: none;

    // If the menu has no content above it
    &:first-child {
      margin-top: -$padding;

      li:first-child {
        border-top: 0;
      }
    }

    // Menu links
    a {
      border-top: 1px solid $border-color;
      color: $color;
      display: block;
      line-height: 1;
      padding: $padding * 0.8;

      &:hover {
        background: $background-hover;
        color: $color;
      }
    }

    .alert > a {
      color: $alert-color;
    }
    .disabled > a {
      color: #999;
      pointer-events: none;
    }
  }
}

/*
  Styles for the action sheet container. Action sheets pin to the top or bottom of the screen.
*/
@mixin action-sheet(
  $position: bottom,
  $shadow: $actionsheet-shadow,
  $animate: $actionsheet-animate,
  $animation-speed: $actionsheet-animation-speed,
  $padding: $actionsheet-padding,
  $background: $actionsheet-background
) {
  background: $background;
  left: 0;
  padding: $padding;
  position: fixed;
  text-align: center;
  transition-duration: $animation-speed;
  transition-property: $animate;
  transition-timing-function: ease-out;
  width: 100%;
  z-index: 1000;

  @if hasvalue($shadow) {
    box-shadow: $shadow;
  }

  // Positions
  @if $position == bottom {
    bottom: 0;
    transform: translateY(100%);

    &.is-active {
      transform: translateY(0%);
    }
  }
  // These two don't quite work as planned yet
  @else if $position == top {
    top: 0;
    transform: translateY(-100%);

    &.is-active {
      transform: translateY(0%);
    }
  }
}

@mixin popup-menu(
  $position: bottom,
  $background: $actionsheet-background,
  $width: $actionsheet-width,
  $radius: $actionsheet-radius,
  $shadow: $actionsheet-popup-shadow,
  $tail-size: $actionsheet-tail-size
) {
  /*
    Core styles
  */
  border-radius: $radius;
  left: 50%;
  opacity: 0;
  pointer-events: none;
  position: absolute;
  width: $width;

  /*
    Menu shadow
  */
  @if hasvalue($shadow) {
    box-shadow: $shadow;
  }

  /*
    Active state
  */
  &.is-active {
    opacity: 1;
    pointer-events: auto;
  }

  /*
    Menu tail
  */
  &::before,
  &::after {
    border-left: $tail-size solid transparent;
    border-right: $tail-size solid transparent;
    content: '';
    display: block;
    height: 0;
    left: 50%;
    margin-left: -($tail-size);
    position: absolute;
    width: 0;
  }

  /*
    Positioning
  */
  @if $position == bottom {
    bottom: 0;
    top: auto;
    transform: translateX(-50%) translateY(110%);
    &.is-active {
      transform: translateX(-50%) translateY(100%);
    }

    &::before,
    &::after {
      border-bottom: $tail-size solid $background;
      border-top: 0;
      bottom: auto;
      top: -($tail-size);
    }
    &::before {
      border-bottom-color: rgba(black, 0.15);
      top: -($tail-size + 2);
    }
  } @else if $position == top {
    bottom: auto;
    top: 0;
    transform: translateX(-50%) translateY(-120%);
    &.is-active {
      transform: translateX(-50%) translateY(-110%);
    }

    &::before,
    &::after {
      border-bottom: 0;
      border-top: $tail-size solid $background;
      bottom: -($tail-size);
      top: auto;
    }
    &::before {
      border-top-color: rgba(black, 0.15);
      bottom: -($tail-size + 2);
    }
  }
}

@include exports(action-sheet) {
  .action-sheet-container {
    display: inline-block;
    position: relative;

    .button {
      margin-left: 0;
      margin-right: 0;
    }
  }
  .action-sheet {
    @include action-sheet;
    @include action-sheet-menu;

    @include breakpoint(medium) {
      @include popup-menu;

      &.top {
        @include popup-menu(top);
      }
    }

    &.primary {
      background: $primary-color;
      border: 0;
      color: isitlight($primary-color);
      &::before {
        display: none;
      }
      &::before,
      &::after {
        border-top-color: $primary-color;
      }
      &.top::before,
      &.top::after {
        border-bottom-color: $primary-color;
      }

      @include action-sheet-menu(
        $color: isitlight($primary-color),
        $border-color: smartscale($primary-color, 10%),
        $background-hover: smartscale($primary-color)
      );
    }
    &.dark {
      background: $dark-color;
      border: 0;
      color: isitlight($dark-color);
      &::before {
        display: none;
      }
      &::before,
      &::after {
        border-top-color: $dark-color;
      }
      &.top::before,
      &.top::after {
        border-bottom-color: $dark-color;
      }

      @include action-sheet-menu(
        $color: isitlight($dark-color),
        $border-color: smartscale($dark-color, 10%),
        $background-hover: smartscale($dark-color)
      );
    }
  }
}
